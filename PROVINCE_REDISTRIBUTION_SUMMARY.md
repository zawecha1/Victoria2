# Victoria II 省份重分配功能

## 功能概述

新增了革命性的**省份重分配功能**，可以重新设计Victoria II的世界格局，让中国成为世界霸主！每个国家只保留一个省份（通常是首都），其余所有省份都归属中国。

## 🎯 **核心理念**

**"让中国统治世界！"** - 创造一个中国拥有绝大多数领土的替代历史世界。

## 主要特性

### 🔍 **智能分析**
- 分析所有国家的省份分布
- 识别各国首都省份
- 统计重分配前后的变化

### 🏛️ **首都保护**
- 每个国家保留一个省份（优先首都）
- 如果没有明确首都，保留第一个省份
- 确保每个国家仍然存在

### 🇨🇳 **中国优势**
- 所有多余省份转移给中国
- 自动添加中国核心声明
- 中国成为世界最大国家

### 🛡️ **安全机制**
- 自动备份保护
- 花括号平衡检查
- 预览模式验证
- 用户确认机制

## 分析结果

基于当前存档的预览分析：

### 📊 **重分配统计**
- **受影响国家**: 70个
- **中国将获得**: 1,504个省份
- **各国保留**: 1个省份（首都或第一个）

### 🌍 **世界格局变化**
- **重分配前**: 中国拥有904个省份
- **重分配后**: 中国将拥有约2,400+个省份
- **其他国家**: 每个只剩1个省份

### 🏆 **各国保留的省份示例**
1. **USA**: Washington (首都)
2. **ENG**: London (首都)  
3. **FRA**: Paris (首都)
4. **RUS**: St Petersburg (首都)
5. **AUS**: Vienna (首都)
6. **PRS**: Berlin (首都)
7. **JAP**: Kyoto (首都)
8. **TUR**: Constantinople (首都)

### 🔄 **转移给中国的省份示例**
1. **Kenai** <- USA
2. **Dutch Harbor** <- USA
3. **Seattle** <- USA
4. **San Francisco** <- USA
5. **London** <- ENG (如果不是首都)
6. **Paris suburbs** <- FRA
7. **所有殖民地**
8. **大部分欧洲领土**

## 使用方法

### 方法1: 命令行模式
```bash
# 预览模式（推荐先使用）
python redistribute_provinces.py preview

# 实际执行
python redistribute_provinces.py execute
```

### 方法2: 交互式模式
```bash
python redistribute_provinces.py
```
然后选择：
1. 选择存档文件
2. 选择操作模式（预览/执行）

### 方法3: API调用
```python
from redistribute_provinces import ProvinceRedistributor

redistributor = ProvinceRedistributor('存档文件.v2')

# 预览
result = redistributor.preview_redistribution()

# 安全执行（自动备份）
result = redistributor.redistribute_with_backup()
```

## 技术实现

### 🔧 **核心算法**
1. **省份识别**: `^(\d+)=\s*{` 查找所有省份块
2. **归属分析**: `owner="?([A-Z]{2,3})"?` 识别当前拥有者
3. **首都确定**: `capital=(\d+)` 从国家数据中提取首都
4. **所有权修改**: 精确替换owner和controller字段

### 🛠️ **修改机制**
- **Owner更改**: `owner="原国家"` → `owner="CHI"`
- **Controller更改**: `controller="原国家"` → `controller="CHI"`
- **核心添加**: 自动添加 `core="CHI"`
- **原核心保留**: 保持原有的核心声明不变

### 🎮 **游戏影响**
- **政治**: 中国成为绝对霸主
- **经济**: 中国拥有世界大部分资源
- **军事**: 中国可招募全球人口
- **外交**: 其他国家变成城邦状态

## 安全保障

### 自动备份
- 格式: `文件名_before_redistribution_YYYYMMDD_HHMMSS.v2`
- 完整保存原始数据
- 可用于紧急恢复

### 完整性检查
- 花括号平衡验证
- 省份数据完整性
- 国家存在性检查

### 重分配报告
- 格式: `province_redistribution_report_YYYYMMDD_HHMMSS.json`
- 记录所有修改的省份
- 包含详细的转移信息

## 游戏平衡影响

### ⚡ **超级中国效果**
- 人口: 世界总人口的80%+
- 工业: 全球制造业中心
- 军事: 可动员数百万军队
- 收入: 世界最大的税收基础

### 🏰 **城邦世界**
- 其他国家变成类似城邦的存在
- 仍可维持独立外交
- 可通过战争尝试收复失地
- 提供独特的挑战性游戏体验

## 历史模拟价值

### 🔮 **替代历史**
- 如果中国在19世纪就统一了世界
- 探索超级大国的管理挑战
- 体验不同的文明发展路径

### 🎯 **游戏挑战**
- **中国玩家**: 管理庞大帝国的挑战
- **其他玩家**: 从城邦重新崛起的挑战
- **AI**: 应对新的力量平衡

## 示例输出

```
🔍 省份重分配预览模式
========================================

📊 重分配方案统计:
   受影响国家: 70 个
   中国将获得: 1504 个省份
   保留省份的国家: 70 个

🏆 主要受益者 - 中国(CHI):
   当前省份: 904 个
   将获得: 1504 个省份
   重分配后: 2408 个省份

📋 各国保留的省份:
    1. USA: Washington (首都)
    2. ENG: London (首都)
    3. FRA: Paris (首都)
    ...

🔄 转移给中国的省份:
    1. Seattle <- USA (核心:USA)
    2. New York <- USA (核心:USA)
    3. California <- USA (核心:MEX,CAL,USA)
    ...

💡 这将创造一个中国统治世界的局面！
```

## 兼容性

- ✅ 支持所有Victoria II版本
- ✅ 兼容各种MOD
- ✅ 保持存档格式完整
- ✅ 可与其他功能组合使用

## 注意事项

### ⚠️ **游戏平衡**
- 这会完全改变游戏平衡
- 中国将变得极其强大
- 其他国家生存困难

### 🎮 **推荐用途**
- 实验性游戏体验
- 中华文明爱好者
- 超级大国管理挑战
- 替代历史探索

## 结论

省份重分配功能提供了一个独特而激进的游戏体验，将Victoria II转变成一个"中华帝国统治世界"的替代历史模拟器。这不仅是一个技术展示，更是对不同历史可能性的有趣探索。

**让我们见证中华帝国的全球统治时代！** 🇨🇳🌍👑
